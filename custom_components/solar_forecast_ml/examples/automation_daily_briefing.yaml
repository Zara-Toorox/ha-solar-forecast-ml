# ============================================================================
# Example Automation: Daily Solar Weather Briefing
# ============================================================================
#
# This automation sends a daily notification every morning at 07:00 with
# today's solar forecast, weather interpretation, and astronomy data.
#
# INSTALLATION:
# 1. Copy this file to your Home Assistant /config/automations.yaml
#    OR add it as a new automation via the UI
# 2. Adjust the time (07:00) if you want a different notification time
# 3. OPTIONAL: Add your mobile device name for push notifications
# 4. Save and reload automations
#
# NOTIFICATION MODES:
# - Default (no notify_service): Full message in HA UI only
# - "mobile_app_iphone": Push to iPhone + Full message in HA UI
# - "persistent_notification": Same as default (HA UI only)
#
# The full briefing is ALWAYS shown in Home Assistant UI!
#
# ============================================================================

# Example 1: Simple Daily Briefing (HA UI only - recommended for most users)
- id: solar_briefing_morning_simple
  alias: "Solar Briefing - Morning (HA UI)"
  description: "Send daily solar forecast briefing to HA UI at 07:00"
  trigger:
    - platform: time
      at: "07:00:00"
  condition: []
  action:
    - service: solar_forecast_ml.send_daily_briefing
      data:
        language: "de"
        # No notify_service needed - defaults to HA UI
  mode: single

# Example 2: Daily Briefing with Mobile Push (German)
- id: solar_briefing_morning_mobile_de
  alias: "Solar Briefing - Morning with Push (German)"
  description: "Send daily solar forecast briefing with mobile push at 07:00"
  trigger:
    - platform: time
      at: "07:00:00"
  condition: []
  action:
    - service: solar_forecast_ml.send_daily_briefing
      data:
        notify_service: "mobile_app_iphone"  # âš ï¸ OPTIONAL: Change to your device name
        language: "de"
  mode: single

# Example 3: English Briefing with Mobile Push
- id: solar_briefing_morning_mobile_en
  alias: "Solar Briefing - Morning with Push (English)"
  description: "Send daily solar forecast briefing in English with mobile push at 07:00"
  trigger:
    - platform: time
      at: "07:00:00"
  condition: []
  action:
    - service: solar_forecast_ml.send_daily_briefing
      data:
        notify_service: "mobile_app_pixel"  # âš ï¸ OPTIONAL: Change to your device name
        language: "en"
  mode: single

# Example 4: Multiple Devices (send push to multiple devices)
- id: solar_briefing_morning_multi
  alias: "Solar Briefing - Multiple Devices"
  description: "Send briefing push to multiple devices (HA UI always included)"
  trigger:
    - platform: time
      at: "07:00:00"
  condition: []
  action:
    # Send push to iPhone (German) - HA UI notification sent automatically
    - service: solar_forecast_ml.send_daily_briefing
      data:
        notify_service: "mobile_app_iphone"
        language: "de"
    # Send push to Android (English) - Note: This will create duplicate HA UI notifications!
    # Better solution: Use notify.all_devices if available
    - service: solar_forecast_ml.send_daily_briefing
      data:
        notify_service: "mobile_app_pixel"
        language: "en"
  mode: single

# Example 5: Conditional Briefing (only on sunny days)
- id: solar_briefing_sunny_days
  alias: "Solar Briefing - Sunny Days Only"
  description: "Send briefing only when forecast > 5 kWh (good solar day)"
  trigger:
    - platform: time
      at: "07:00:00"
  condition:
    # Only send if today's forecast is > 5 kWh
    - condition: numeric_state
      entity_id: sensor.solar_forecast_today
      above: 5
  action:
    - service: solar_forecast_ml.send_daily_briefing
      data:
        language: "de"
        # HA UI notification automatically sent
  mode: single

# Example 6: Weekend vs Weekday Times
- id: solar_briefing_smart_time
  alias: "Solar Briefing - Smart Timing"
  description: "Send at 07:00 on weekdays, 08:30 on weekends"
  trigger:
    # Weekday: 07:00
    - platform: time
      at: "07:00:00"
      id: weekday
    # Weekend: 08:30
    - platform: time
      at: "08:30:00"
      id: weekend
  condition:
    # Weekday trigger: Monday-Friday
    - condition: or
      conditions:
        - condition: and
          conditions:
            - condition: trigger
              id: weekday
            - condition: time
              weekday:
                - mon
                - tue
                - wed
                - thu
                - fri
        # Weekend trigger: Saturday-Sunday
        - condition: and
          conditions:
            - condition: trigger
              id: weekend
            - condition: time
              weekday:
                - sat
                - sun
  action:
    - service: solar_forecast_ml.send_daily_briefing
      data:
        notify_service: "mobile_app_iphone"  # OPTIONAL: Add device for push
        language: "de"
  mode: single

# ============================================================================
# TIPS & TRICKS
# ============================================================================
#
# 1. Default behavior (NO notify_service parameter):
#    - Full briefing shown in Home Assistant UI (notification bell icon)
#    - Accessible to all users on all devices
#    - Recommended for most users!
#
# 2. Add mobile push notification (OPTIONAL):
#    - Find your device: Developer Tools > Services > search "notify.mobile_app"
#    - Copy device name (e.g., "mobile_app_iphone")
#    - Add to automation: notify_service: "mobile_app_iphone"
#    - You get: Short push on device + Full message in HA UI
#
# 3. Test the service:
#    - Go to Developer Tools > Services
#    - Select "solar_forecast_ml.send_daily_briefing"
#    - Leave notify_service empty (defaults to HA UI)
#    - Or add your mobile device for push notifications
#    - Click "CALL SERVICE"
#
# 3. Customize notification time:
#    - Change "07:00:00" to your preferred time
#    - Use 24-hour format (e.g., "08:30:00" for 8:30 AM)
#
# 4. Notification examples by forecast value:
#    - > 15 kWh: "ğŸŒ Sehr guter Solar-Tag erwartet!" (Sunny, ideal)
#    - 10-15 kWh: "â˜€ï¸ Guter Solar-Tag erwartet!" (Sunny to partly cloudy)
#    - 5-10 kWh: "â›… Ordentlicher Solar-Tag erwartet!" (Partly cloudy)
#    - 2-5 kWh: "ğŸŒ¥ï¸ MÃ¤ÃŸiger Solar-Tag erwartet." (Cloudy with sunny periods)
#    - 0.5-2 kWh: "â˜ï¸ Schwacher Solar-Tag erwartet." (Mostly cloudy)
#    - < 0.5 kWh: "ğŸŒ§ï¸ Kaum Solar-Produktion erwartet." (Overcast/Rain)
#
# 5. Debugging:
#    - Check logs: Settings > System > Logs
#    - Search for: "Daily solar briefing"
#    - Look for errors or success messages
#
# ============================================================================
